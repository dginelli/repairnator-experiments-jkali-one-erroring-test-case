<form id="roleAssociationForm" th:object="${createForm}" class="row">
  <div class="mb-3 col-12">
    <input type="hidden" th:field="*{userId}"/>
    <div class="form-check form-group mb-3" id="formInputRole">
      <label th:text="#{role.name.label}"/>
      <select th:field="*{roleId}" class="form-control">
        <option value=""></option>
        <option th:each="linkableRole : ${linkableRoles}" th:value="${linkableRole.id}"
                th:text="${linkableRole.name}"></option>
      </select>
      <small class="form-text text-muted" th:text="#{role.name.help}"/>
    </div>
    <div class="float-right">
      <a class="btn btn-md btn-success fa fa-plus fa-white" onclick="postCreateResponsibilityForm()"
         th:if="${currentUser.hasPrivilege('administration:responsibilities:create')}"></a>
    </div>
  </div>
</form>
<div class="row mt-3" id="associatedRoles">
  <table class="table table-bordered table-hover">
    <thead>
    <tr>
      <th scope="col" colspan="3">
        <label th:text="#{role.name.label}"/>
      </th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="associatedRole : ${linkedRoles}">
      <td colspan="2">
        <a th:href="'/manager/roles/' + ${associatedRole.id}" class="table-link">
          <span th:text="${associatedRole.name}"/>
        </a>
      </td>
      <td class="text-center" colspan="1">
        <a class="btn btn-md btn-danger fa fa-times fa-white" th:id="${associatedRole.id}"
           th:if="${currentUser.hasPrivilege('administration:responsibilities:delete')}"
           onclick="deleteAssociatedRole(this.id)"></a>
      </td>
    </tr>
    </tbody>
  </table>
</div>
<script th:inline="javascript">
  var deleteAssociatedRole = function (idAssociatedRole) {

    var inputUserId = $("#userId");
    var userId = inputUserId.val();

    $("#roleAssociationForm").hide();
    $("#associatedRoles").hide();
    $(".loader").show();
    var url = "/manager/responsibilities/" + userId + "/" + idAssociatedRole;
    $.ajax({
      url: url,
      type: "DELETE",
      success: function () {
        currentTab = "";
        $(".loader").hide();
        goToRolesTab();
      },
      error: function () {
        currentTab = "";
        $(".loader").hide();
        goToRolesTab();

      }

    });
  }

  var postCreateResponsibilityForm = function () {
    $("#roleAssociationForm").hide();
    $("#associatedRoles").hide();
    $(".loader").show();
    var url = "/manager/responsibilities";

    var associatedRoleForm = {};
    var inputUserId = $("#userId");
    var inputRoleId = $("#roleId");

    associatedRoleForm.userId = inputUserId.val();
    associatedRoleForm.roleId = inputRoleId.val();

    var data = JSON.stringify(associatedRoleForm);
    $.ajax({
      type: "POST",
      url: url,
      data: data,
      contentType: "application/json; charset=utf-8",
      crossDomain: true,
      dataType: "json",
      success: function (data) {
        currentTab = "";
        goToRolesTab();
        $(".loader").hide();
      },
      error: function () {
        currentTab = "";
        goToRolesTab();
        $(".loader").hide();
      }
    });
  }
  $(document).ready(function () {
        $(".card-loader").hide();
        $(".loader").hide();
      }
  );
</script>
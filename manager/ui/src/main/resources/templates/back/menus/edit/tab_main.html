<form id="menuEditForm" th:object="${updateForm}">
  <div class="card mb-4">
    <div class="card-header">
      <div th:replace="common/back_delete_link :: deleteSimple(${'webmastering:menu:delete'})"/>
    </div>
    <div class="card-body">
      <div class="form-check  mb-3" id="formInputTitle">
        <label th:text="#{menu.title.label}"/>
        <input type="text" class="form-control" th:field="*{title}"/>
        <small class="form-text text-muted" th:text="#{menu.title.help}"/>
      </div>
      <div class="form-check  mb-3" id="formInputPage">
        <label th:text="#{menu.page.label}"/>
        <select th:field="*{pageId}" class="form-control">
          <option th:each="page : ${pagesThatCanBeLinkedTo}" th:value="${page.id}"
                  th:text="${page.name}"></option>
        </select>
        <small class="form-text text-muted" th:text="#{menu.page.help}"/>
      </div>
      <div class="form-check  mb-3" id="formInputParent">
        <label th:text="#{menu.parent.label}"/>
        <select th:field="*{parentId}" class="form-control">
          <option value=""></option>
          <option th:each="menu : ${menusThatCanBeParents}" th:value="${menu.id}"
                  th:text="${menu.title}"></option>
        </select>
        <small class="form-text text-muted" th:text="#{menu.parent.help}"/>
      </div>
      <div class="form-check  mb-3" id="formInputLabel">
        <label th:text="#{menu.label.label}"/>
        <input type="text" class="form-control" th:field="*{label}" readonly="readonly"/>
        <small class="form-text text-muted" th:text="#{menu.label.help}"/>
      </div>
      <div class="form-check  mb-3" id="formInputHref">
        <label th:text="#{menu.href.label}"/>
        <input type="text" class="form-control" th:field="*{href}"/>
        <small class="form-text text-muted" th:text="#{menu.href.help}"/>
      </div>
      <div class="form-check  mb-3" id="formInputOrder">
        <label th:text="#{menu.order.label}"/>
        <input type="number" class="form-control" th:field="*{orderInMenu}"/>
        <small class="form-text text-muted" th:text="#{menu.order.help}"/>
      </div>
      <input type="hidden" th:field="*{id}"/>
      <input type="hidden" th:field="*{creationDate}"/>
      <input type="hidden" th:field="*{creationUser}"/>
      <input type="hidden" th:field="*{modificationDate}"/>
      <input type="hidden" th:field="*{modificationUser}"/>
    </div>
    <div class="card-footer">
      <div class="float-right">
        <a class="btn btn-md btn-danger fa fa-times fa-white" onclick="cancelUpdateMenu()"></a>
        <a class="btn btn-md btn-success fa fa-check fa-white" onclick="postUpdateMenuForm()"
           th:if="${currentUser.hasPrivilege('webmastering:menu:write')}"></a>
      </div>
    </div>
  </div>
</form>
<div class="card card-loader">
  <div class="loader">
  </div>
</div>
<script th:inline="javascript">

  var toggleFields = function (parentValue) {
    var hrefElement = $("#formInputHref");
    var labelElement = $("#formInputLabel");

    if ("" === parentValue) {
      hrefElement.hide();
      labelElement.hide();
    } else {
      hrefElement.show();
      labelElement.show();
    }

  }

  $(document).ready(function () {
    $(".card-loader").hide();
    $(".loader").hide();
    var parentSelect = $("#parentId");
    toggleFields(parentSelect.val());
    parentSelect.on('change', function () {
      toggleFields(parentSelect.val());
    });
    $("#confirmDelete").click(function () {
      var url = "/manager/menus/" + [['' + ${updateForm.id} +'']];
      var urlFallBack = "/manager/menus";
      var form = $("#menuEditForm");
      var loader = $(".loader");
      var cardLoader = $(".card-loader");
      deleteAndHandleResult(form, loader, cardLoader, url, urlFallBack);
    });
  });
</script>
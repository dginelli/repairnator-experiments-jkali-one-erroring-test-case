sudo: required


services:
- docker


language: java
jdk:
- oraclejdk8


env:
  global:
  - secure: t0FJWUWQ660aEJ3d8oaEamzXPdUh413OWG/743N2aDCbCznF0XPFabH8dU1o2Y1evw4wzo0d9akn/DRysb2gNRcWjZCFdZ+PmYrKooV9zqBDQOsU3mvHE8wCBJf8YXyUDbJ+EgBdlp/eVGTGgijLy1kPCVEqq3RdMGip3VIDxCsA9qrZhqw3UPgX0pNesCmfKnK7cMcE+WRWtFpqWg3FTjl0xwU2rOdaCyxZdNwClrKfazxEdGIDhvvdMTMDPXcMs/eOBNeVoWgY/0gF6tk2oePqyOBcYJJuhZjXBEWB+HRzwDalrP/SOMOWxSeMEwUcRMKY5UyIceQbr52U/yU8Ii+90mX1aLIcCW8vAfTbSk4FEKl0YGcZg04s9Gn29JSZOJeNZSk/ne2t4li805ofWhQHhBzw+1tx/Xy1YrD+xVn1OeySD0jcrhYdEuEplqWTyPz0EIINPkG0Br21l1OcoSTyNIdJFmTISUQeRBMgqo8ILxDsa2AJKM6soUhoZ48Pb0f6zeuBPs2FCBdPA5EKNcDP1vLMv8qE1EMgTSxPU7AeoynTocrNn0V2Ji5a9Qp1rV9pJGcvTNuBCsxL7mfIeAh3ZTmHQOAdCVMCpDEC+qB7O9YmAAgcFdC4Isaxnbe/4gPsxpx7VWseIAgukSJf10l6FlDbI/H0LllngLnknU8= #DOCKER_EMAIL
  - secure: oViviIlPp2riJZjb+sUUqlfk+Xgj+ThglqjrCoyZ2ReS5yKZv3XhgEwO9LeGchUKnnlStM3b5kISH0OVx9Vxr//umlnIlAwPR9e5yWmrvjYDcRK/36v/pfBXeZsne7/bVkwdT0l0O3mIUOoVkTrjj10F8UyFFcKPNV1sUKUUn07Gh5dnjeHcHZebTZojHDdsU5e1kYnkIaEhi/W/+jEvUkuSLE3vrPi6VxPU5gxQ8wbMqSi/UT8JXCGRyMdgL6HCdmooSvSqZWVJo0Fxq+jDpOEpJuzIO8Ly17GaEguwNesJgBwkm6VI6O1bKIewKJ2BGMY62f7eVEWARCe/zS1Q+1fZpuTrgRF2GCmP6kaNasx+Yiby9XaSnHKLwU3tHfXoDgU29altg9T2kgM1pU67H2VxxNvYqoDCk+7T4CRxyPa6dSDn0bKjUsU6kw8cyG22UEJJyu7QNiQB1cz48krlF8JSScwyt2FSPrzoG2hf61LFO1GQo9jL/BH+8YFHpH6zGX+87HbC87I7mVxMqizmQTKs8VEUyettfNxh1w3uxBXB9n+NngZbEqDHpajv+4sOG+a/RTqkLGQ1ovifQsZ9eG/1Fnr6hnAu+oLJwy8l6Do8i4z10IqBKJWRtVA4pZGR/c3pk6smVQKdoHyw1vIZzRa+mRnDrMa9pt8VAEvPmGA= #DOCKER_USER
  - secure: bzQBnsXIx7WIW+LsJw1UfZXmEKoAsa1bzXppX4ZRLlLuViOx1p5W+JrnNVKlZG+2o1AIjvOuvysWOzuTohJJnTmdGJQLKxvQpdULx2HamWCuspRkc7pMVyzzIaFvQshu8AcyCHEYYlKaVdZJAizPYyeIr2xKyppWu8Lfv4uZzi3mC3FxyytyA9BgwJf7IxwN2ToBQk0i6NG4NOKbcgwbmcZFSRzQ1pd3lUZB6TJ/DU+p4FLZJUKnlS7aGsbFcWxgIlJKZve6Tsi9xyAkyg3oOs+le4HyWPcf8Yfvjf5RQDJ8w3AVUxTN3eLBLVjegiMrUmG6P4eBjGQ4nHx2I2niS4b3wOJlFQ5Cod9PjBPQtGbD94dzK03NkEN4CD2X2s/lrOvghq/ilGNboFLJVWoy4BeObiRMWL/qL0kembdIACw6c5AjIKjLiDikMbvV45VUkyXyNAQRQzVPCMTEY73xwt9XeG6XMAdZ3u+FT3mIAsJR+g5u/RsSydNJ2e3nf6EIkYN6TEZYVAHXpiMHmrDSh65w6Wqoob7+kH+h/fleBLAmBgzYYNQxEx0SAIVLbvNciF7MjaBvwO6a8zQvl1//AtQVMlvVr4JsdtHNM09PkCXxeM1cIRsF1aZdFxob0keVgtXod7HD+TafEUg0q7xSGDImte6WsQk6AcyjzRgtpD0= #DOCKER_PASS
  - COMMIT=${TRAVIS_COMMIT::7}


after_success:
  - docker login -u $DOCKER_USER -p $DOCKER_PASS

  #TAG
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`

  # CONFIG SERVICE
  - export CONFIG=gonac/config-service
  - docker build -t $CONFIG:$COMMIT ./config-service
  - docker tag $CONFIG:$COMMIT $CONFIG:$TAG
  - docker push $CONFIG

  # REGISTRY SERVICE
  - export REGISTRY=gonac/registry-service
  - docker build -t $REGISTRY:$COMMIT ./registry-service
  - docker tag $REGISTRY:$COMMIT $REGISTRY:$TAG
  - docker push $REGISTRY

  # USER AUTHENTICATION SERVICE
  - export AUTH_SERVICE=gonac/user-authentication-service
  - docker build -t $AUTH_SERVICE:$COMMIT ./user-authentication-service
  - docker tag $AUTH_SERVICE:$COMMIT $AUTH_SERVICE:$TAG
  - docker push $AUTH_SERVICE

  # USER PROFILE SERVICE
  - export PROFILE_SERVICE=gonac/user-profile-service
  - docker build -t $PROFILE_SERVICE:$COMMIT ./user-profile-service
  - docker tag $PROFILE_SERVICE:$COMMIT $PROFILE_SERVICE:$TAG
  - docker push $PROFILE_SERVICE

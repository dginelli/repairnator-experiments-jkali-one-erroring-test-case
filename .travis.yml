sudo: required

services:
  - docker

language: java
jdk:
 - oraclejdk8


env:
  global:
  - secure: "FYBoZ8UZuuYAQh3+3H/I9+R+Rijp0uvuds0bI7kX0QnPceeKr927RI7PFptzi/ns+nVsT71VBp+gula7PtGXEG3ErtxHffXvM1zBztgDO8cZF4YU9isjYdds1TLMagjaE1ZLjy9sVQnPz6wmjwfJYkdYh9gRH/h/NdQFC6qT1LT3RyJSQUp+0uJNZunsI8UPWBr+teohTDdABgmTHXO48EvsdA+cZPsV9p3gANXOXE+UcKzV1dXfsqJ+Rdr4Kh8wxROjmDwPmTaiJgzD7UrBkH1GIB9dKcuCyxIoDVhe8iyxINHc/LiMxX9clorJItAvdvPqx5t46gDduFiqTAFM5z+qwOn7iJzqwakD1EpxLDSQo915KHiG1yoLxiL/meZMpgg0YUeQ/zZgskabZXeNE1jUhy3verwUiSX4L30TabRxNI8PaEcigmkUQKSedMe9RmLYpfXnESjTWXMEjtczrz/9IaJP7iy2IgQw2rMkTJ1cVUUqExJGe1+v4hLn+udMwZU9tiOIM3PnUdF9NXn0DBD2HbvaNPUyUIr2PxMqCqNW9Jlp87KO4TKlbCahBOo/rreCakqoKGs2w9l9rkat42nQn09uLG28hjKMlhouylSU0+tr/F41ncAjgztW/BjFqMT5kKw519wc1jKxHwvd1drZcrGqel33nHYwrU8eIEs=" # DOCKER_USER
  - secure: "nV9D7bWeIPCTThECPNdKuX2kNbM99Vkc21PzBrrbFU73m+QDhheYRq1dT7m10OZaNdTwTbF2JwMfgU1P6uU0GkxHnW68KQAanKbtK1KGyAgjBPKjTCeCr5qs5UnSQBAdYujpNGAM8K8xfhlRp5LBOPGAFSkOAEH7CEg48K396YwuIRl7s8QzDsRbV0YBrq6a6b7mQ7JA92q7AamMxzmRqIn1o+KZtcoUnJfQcULJmmTnO0wTEsjBnBt449lha+xf5Zod714AWxLoTaKtVfqQWGn0sAYOddVIlszkCf3A4CRoGfx6EygC8PltQKsiT/Nc4oribaj5HmtrzqG0BhPGQwR/7Q+dZtK2nNOvCUDvuVZ/ohRTabBckRSvnWc1LuDNUxRZTz0d0T8oxRe0ElHnTmLOp3RFClmIcRix3bSoS2sJ/4RbglA/ZZCuLhb/T7X/MungdyBL7cyRiMs3nnrbgao85OHMVMEV/o1aYEuBXiPmLXVyv8wdzbyF2klTryPSEUXV923KHdlkcaARUtRxmat87hkIWCHW7i0oqFQBiwrqT2aCMKFhNgV2SC2DbxcrqwbpvMU6vuvCMWELbc2N+W38uDSBZmlLNTpF5O0YXDHzHRzi13agNsRz8MN29fipJmI61QE65SL789URgWKuH0zSDB/2fYjTnhjwglfToc4=" # DOCKER_PASS
  - secure: "Sw1NEEm+eWRdJGbBlUbhpSOGSfNu1gYXPZVNYcKv/fZXaGZKv9PR+IOy/vxRqaGiC2S4gGuxiccuCPbj2OBWrLzB+zlOW2XYu2ey6346BPrNFqNQdZThcBqtVOx+lxGkEbUERhiO4JsIvKgMwhKmBh+yR9+UtySmfXvxgfsA4suLKwZ3574vDaN6eFzB2ElO799qNKr4RBQHakXLc3nhSIMlJrnMhah2GZYShN8PMD0OXqHcYrdvK7TRpnc0LHOR7uNEiSiQPm+jVgQ8W2JQIumOiMTCTcjgWGPRuurWbcME3NsbqmM2hPppjDueQv36d8UBxp7E2sNeuCeblYsXYjFfL/mIrIubac3A4JGzuVIYjDpdJLV2pxI6HSYxXGTwrqVClu/Vksf5v9d1Kx9wiNjg4jwB67wu/KFXCDVWMOft7EIRqeqMu+gWt8nufB40kubWmA9IWztzCC0Pea3+KkCzyM9iNQwiqZgWTCEI2LHGsb5IRPk4N/OHQKXYSQllu4eZeRhDCRruLxGIOCq46ubj8bxlHAv1lHY35tWErE13Mi0d33IFP5yvCEIUUKvEISYP4i/sWPjvkbyOvxiW85tXOrrNShzjPlKOVJjUs1aJjOLVoDZ61N5Z2rSiftvkoP24IosHVqO49d59ne1EQ4edltfOubABLGDpSgFX3dU=" # DOCKER_EMAIL
  - COMMIT=${TRAVIS_COMMIT::7}

script:
  - ./mvnw clean install -B

after_success:
  - docker login -u $DOCKER_USER -p $DOCKER_PASS
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
  - export IMAGE_NAME=bettor-league-api
  - docker build -t $IMAGE_NAME:$COMMIT .
  - docker tag $IMAGE_NAME:$COMMIT nadjim/$IMAGE_NAME:$TAG
  - docker push nadjim/$IMAGE_NAME

deploy:
 provider: heroku
 api-key:
  secure: "UJEmkN+K5WFi5IS6lL2KgcA6qkZ3erlvTMz1hqw6h4P9g3IiUPr7wDkqHpIs/z+nxEMTxIfhZhNT6Qdkp0F99RFdXkCZIDTVF4xFrKADJoXcsY5Rr9izIML84jqJoLZOXguKg1kcGgRupvcgHwgAR/KZb/oS8P3U/8abMCgPAvW5a2yMtF11C3MHAgGfRnJS8rJFwqr8gmOyCg02nEEJo5EMZYeg8RY9GqOx3KAzTehq8snMR4I7MFoWqeaEIC1lt/EFHqypdPJtH1Rknb9OAtplx6R/X7OieQWliPTxuzWq/CT/KOqgyOXXDMrfGKJSVUO9jg/BgLV5u4ihWVe5KhvWJKeyGs/HNNBCzuAW+3Yl/IqYH6VUd7NkENYy31o80i7JUbF7Meatj2ZvX/PJra650mn33c17FyLJb1XxPhWYimYw3/UMatLpvLSdGvUsZPCXU8fXCf136PE8/zMwECMRqUPR2UoLNFE+rS91MHSPMBMBrHL1Ym4y+ii3//sm6rZJQADEJlqezNU4guevVUBPNtwBDxKJxd7jr1Uy7jxGFaadJy7/aA8VAzn85sckJjruNTQJ1ewWM7IjaIJjVVgNcSEzSysaFOgvTEmP2DKJ6CcH1+kOwRr5Zlo+zg64ncTNLwXxcvjEU+1lEc2MpZPchP6CP9XjEWrnHKPuvmY="
 app: bettor-league
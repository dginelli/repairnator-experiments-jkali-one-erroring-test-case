# MAARS manual (deprecated)

## Launching MAARS with Fiji ops (post-analysis)

## Launching MAARS with Micro-Manager on-the-fly plugin (evolving... so unstable)
You can find MAARS in `Plugins` of **Micro-Manager toolbar** (not ImageJ toolbar!). Then you will see this main dialog which is designed to change different parameters of MAARS,

![main_frame_clean][]  

and the log dialog which displays the progress of MAARS.

![log_dialog][]  

## Quick start
### Main frame

![main_frame][]  

1. Define width and height of the multi-position course
2. Configure segmentation parameters
3. Configure fluorescent analysis parameters for each time point
4. Static / dynamic analysis :
	- static : take a snapshot for each field of camera view
	- dynamic : perform a N minutes recording/analyzing for each field of camera view
5. Perform post-analysis or acquire new images
6. Save all the specify parameters for current analysis, so that the user can use the same parameters in next run
7. The folder that contains previously acquired image (post-analysis) or the saving path for images and the analyzing results (on-the-fly analysis)
8. Run MAARS
9. Show the visualizer of parameters
10. Stop

# Segmentation analysis parameters

![][seg_params]  

This set of parameters are optimized to film wild-type fission yeast cells with large-field microscope.  
Generally you shouldn't need to change movie parameters. Except you aren't working with fission yeast.  
The min/max cell area are used to filter out large inter-cell spaces ROIs.  
__Note: Be carful with mutants of cdc25 deleted. you should increase the max cell area to detect elongated cells.__
The mean grey value is used to filter out ROIs of background. Generally, you won't need to change it.
The [solidity][] is crucial for the detection of abnormal cell shapes i.e. banana shape, round etc.  

the __test segmentation__ button can test the segmentation with current parameter. If bf image is detected in the main dialog, MAARS will perform the test on it, otherwise MAARS acquire a new image and test on it.

User can also skip the segmentation by selecting the checkbox on the top the dialog. However, user should provide the ROIs and analysis of ROIs in the folder of working directory.

# Fluorescence analysis parameters

![fluorescence_dialog][]  
On the top of the dialog, user can specify how the acquisition will be performed as in other imaging systems.  
When the __do analysis__ is unchecked, MAARS will only acquire images without fluorescence analysis. Note that when time interval is too short i.e. <10000ms, this button with be automatically unchecked.  

The configuration group combobox allows user to select Micro-Manager configuration which corresponds to channel configurations.  
On the bottom of dialog, the checkbox at the head of each line indicates whether or not to use this channel. Then user can select the channel to use. For each channel there are some parameters need to be specified.  
__Max # of spot :__ maximum number of spot to keep in current channel in one cell.  
__Spot Radius :__ the radius of spots in Âµm  
__Quality :__  minimum of spots quality to keep (from Trackmate)
__Exposure :__ exposure of current channel  
__Spindle? :__ which channel SPBs are marked (for mitosis detection)  

## Tuning fluorescence analysis parameters
The most delicate part of MAARS is to tune fluorescence parameters. The goal is to detect the fluorescent spots correctly in all channels with minimum errors. However, images of microscope are often noisy and it depends on a lot of parameters from the microscope.
To see result of the detection, user can click on test button on the right. Again, if images are available in saving path, MAARS will find it and perform the detection on it. Otherwise new images will be acquired and be tested.  
Note that the quality depends "visibility" of spots on projected image. Thus, please keep in mind that any changes in **the z-slice of acquisition**, **exposure time** or **channel intensity** will change the quality of detection.  

# Output of MAARS  

![output_folders][]  

The **maars_config.xml** contains the configuration of current acquisition.  
The **X(number)_Y(number)** structure means the data of position X and position Y.  
The folder **X(number)_Y(number)** contains bright-field images and result of segmentation.  

![bf_folder][]  

The bright-field image are always save in the **\_1** folder with a name of **\_1\_MMStack_Pos0.ome.tif**  
All the other files are generated by MAARS segmentation.  
_note_: When performing post-analysis without MAARS segmentation, the BF_result.csv and ROI.zip file should be both provided with the same name.  

The **X(number)_Y(number)_FLUO** folder contains all fluorescence acquisitions and unfiltered results:

![fluo_folder][]  

For each frame, images are saved into **(channel)_(frame)** folders with the same prefix for each image.  
_note_: it is important to respect this structure for post-analysis, including the name of the files.  

![unfiltered_output][]  

The unfiltered results of analysis are saved into three folder: **croppedImgs**, **features** and **spots**.  

**croppedImgs**: cropped images of all detected cells (.tif)  
**features**: measurements such as spindle angle and spindle length for each cell (.csv).  
**spots**:  all spots detected in all cells (.xml of Trackmate).  

The **X(number)_Y(number)_MITOSIS** folder contains all information of cells detected as mitotic cells:  

![mitosis_folder][]

The folders croppedImgs, features and spots contains same data as in FLUO folder but only from mitotic cells.

**figs** : contains plots of analysis : three plots for each cell.

![elongation][]  
Spindle elongation curve (x labels are the frame numbers. To calculate time in minutes t : `t = frame_number * time interval / 60`)

![slopChangePoints][]  
Normalized (to current cell major axis length) spindle elongation with maximum slope change time point detected. In the example, MAARS detected two maximum slope changes time points : frame 15 and frame 69.  

 _colors of slope change_: Blue squares and red triangles under the spindle elongation are the slope change of each time point. Blue indicates negative change; red indicates positive change
 _colors of fitted line overlapping with elongation curve_: red color indicates positive slope , blue indicated negative slope.

![SPBtracks][]  
SPB tracks in current film

### Visualizer




# For developers
 `build-mm.sh` : use this script to build Micro-Manager under Linux.
 (obsolete)`mavenized-mm.sh` : use this script to update local Maven repository inside `repo/`. MM jars used are `MMJ_`, `MMCoreJ` and `MMAcqEngine`.

`update-libs.sh` : use Maven to build MAARS and copy all dependencies to `jars/`. It allows "basic users" to copy the required .jar file to a standard Micro-Manager installation.

`install.sh` : Use to install MAARS plugin and its dependencies to Micro-Manager installation.

# Developing with Eclipse/Netbean/IntelliJ
# TroubleShooting
please use Github new issue to report: https://github.com/bnoi/MAARS/issues/new

[main_frame_clean]: images/main_frame_clean.png
[main_frame]: images/main_frame.png
[log_dialog]: images/log_dialog.png
[output_folders]: images/output_folders.png
[bf_folder]:images/bf_folder.png
[fluo_folder]:images/fluo_folder.png
[unfiltered_output]: images/unfiltered_output.png
[mitosis_folder]: images/mitosis_folder.png
[elongation]: images/elongation.png
[slopChangePoints]: images/slopChangePoints_15_69.png
[SPBtracks]: images/SPBtracks.png
[seg_params]: images/seg_params.png
[solidity]:https://imagej.nih.gov/ij/docs/guide/146-30.html
[fluorescence_dialog]:images/fluorescence_dialog.png
